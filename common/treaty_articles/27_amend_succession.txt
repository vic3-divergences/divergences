amend_succession = {
    kind = directed
    cost = 25

	relations_progress_per_day = 0.5
	relations_improvement_max = 25

	icon = "gfx/interface/icons/diplomatic_treaties_articles_icons/law_commitment_treaties.dds"

    flags = {
		can_be_renegotiated
        can_be_enforced
    }

	usage_limit = once_per_side

	maintenance_paid_by = target_country

	visible = {
        has_dlc_feature = ip4_content
		c:BRZ ?= this
        scope:other_country = {
            c:POR ?= this
        	has_journal_entry = je_portugal_united_kingdom
		}
	}

    possible = {
        has_law = law_type:law_monarchy # Brazil must be a monarchy and not have Regency
		NOT = {
			has_gov_regency = yes
		}
        scope:other_country = {
            c:POR ?= this
            has_law = law_type:law_monarchy
		}
	}

	requirement_to_maintain = {
		trigger = {
			scope:target_country ?= {
                has_journal_entry = je_portugal_united_kingdom
                has_law = law_type:law_monarchy
            }
			scope:source_country ?= { has_law = law_type:law_monarchy }
		}
	}

    can_ratify = {
        scope:target_country = {
            has_law = law_type:law_monarchy
        }
        custom_tooltip = {
            text = DUPLICATE_ARTICLE_SAME_INPUTS_TREATY
			NOT = {
				scope:source_country = {
					any_scope_treaty = {
						hidden_trigger = {
							OR = {
								scope:treaty = {
									is_renegotiation = no
								}
								scope:treaty.amended_treaty != this
							}
						}
						any_scope_article = {
							has_type = amend_succession
							source_country = scope:source_country
						}
					}
				}
			}
        }
    }

    on_entry_into_force = {
		c:POR ?= {
			if = { # Only fire the event once
				limit = {
					NOT = {
						has_variable = lusofonia_1_fired
					}
				}
				trigger_event = {
					id = lusofonia.1
				}
			}
			else = {
				c:BRZ ?= {
					if = {
						limit = {
							exists = heir
						}
						hidden_effect = {
							heir ?= {
								set_variable = brazil_spurned_heir
								place_character_in_void = 10000
							}
						}
					}
					set_heir = c:POR.ruler
				}
			}
        }
	}

	on_withdrawal = {
        if = {
            limit = {
                c:BRZ ?= scope:withdrawing_country
            }
            scope:withdrawing_country ?= {
                heir ?= {
                    disinherit_character = yes
                }
                if = {
                    limit = {
                        any_character_in_void = {
                            has_variable = brazil_spurned_heir
                        }
                    }
                    random_character_in_void = {
                        limit = {
                            has_variable = brazil_spurned_heir
                        }
                        save_temporary_scope_as = spurned_heir_scope
                        custom_tooltip = {
                            text = spurned_heir_restored_tt
                            free_character_from_void = yes
                        }
                    }
                }
            }
        }
    }
	on_break = {
		scope:withdrawing_country = {
			change_relations = { country = scope:non_withdrawing_country value = -10 }
		}
	}

	ai = {
        treaty_categories = {
			ideology
		}

		evaluation_chance = {
			value = 0.1

			add = {
				value = country_rank
				multiply = 0.05
			}
		}

		article_ai_usage = {
            request
        }

		inherent_accept_score = {
			value = 0

			if = {
				limit = {
					scope:source_country ?= this
				}

				# We are doing this to be able to reuse loc across treaties and diplomatic actions
				scope:source_country = {
					save_temporary_scope_as = actor
				}
				scope:target_country = {
					save_temporary_scope_as = target
				}

				add = {
					desc = "DIPLOMATIC_ACCEPTANCE_BASE_ADDITIONAL"
					value = -50
				}

				add = {
					desc = "DIPLOMATIC_ACCEPTANCE_ATTITUDE"
					if = {
						limit = {
							OR = {
								has_attitude = {
									who = scope:target_country
									attitude = antagonistic
								}
								has_attitude = {
									who = scope:target_country
									attitude = domineering
								}
								has_attitude = {
									who = scope:target_country
									attitude = belligerent
								}
							}
						}
						value = -1000
					}
				}

				add = {
					desc = "DIPLOMATIC_ACCEPTANCE_INFAMY"
					if = {
						limit = {
							"scope:target_country.infamy" >= infamy_threshold:pariah
						}
						value = -1000
					}
				}

				if = {
					limit = {
						"num_alliances_and_defensive_pacts_with_rivals(scope:target_country)" > 0
					}
					add = {
						desc = "DIPLOMATIC_ACCEPTANCE_ALLIED_TO_RIVALS"
						value = -1000
					}
				}

				if = {
					limit = {
						exists = power_bloc
						exists = scope:target_country.power_bloc
					}
					if = {
						limit = {
							power_bloc = scope:target_country.power_bloc
						}
						add = {
							desc = "DIPLOMATIC_ACCEPTANCE_SAME_POWER_BLOC"
							value = 25
						}
					}
					else = {
						add = {
							desc = "DIPLOMATIC_ACCEPTANCE_DIFFERENT_POWER_BLOC"
							value = -25
						}
					}
				}
			}
			else = {
				scope:target_country = {
					save_temporary_scope_as = actor
				}
				scope:source_country = {
					save_temporary_scope_as = target
				}

				add = {
					desc = "DIPLOMATIC_ACCEPTANCE_BASE_ADDITIONAL"
					value = 30
				}
			}
		}
	}

	wargoal = {
		execution_priority = 21
		contestion_type = control_any_target_country_state

		maneuvers = {
			value = 2.5

			scope:target_country = {
				multiply = {
					value = total_population
					divide = define:NDiplomacy|SWAY_OFFER_WARGOAL_MANEUVERS_COST_POPULATION_SCALING_FACTOR
					multiply = define:NDiplomacy|SWAY_OFFER_WARGOAL_MANEUVERS_COST_POPULATION_SCALING_MULTIPLIER
                    max = define:NDiplomacy|SWAY_OFFER_WARGOAL_MANEUVERS_COST_POPULATION_SCALING_MULTIPLIER_MAX_TOTAL
				}
			}
		}

		infamy = {
			value = 0.25

			scope:target_country = {
				multiply = {
					value = total_population
					divide = define:NDiplomacy|WAR_GOAL_INFAMY_POPULATION_SCALING_FACTOR
					multiply = define:NDiplomacy|WAR_GOAL_INFAMY_POPULATION_SCALING_MULTIPLIER
                    max = define:NDiplomacy|WAR_GOAL_INFAMY_POPULATION_SCALING_MULTIPLIER_MAX_TOTAL
				}
			}
		}
	}
}

je_dual_integration = {
	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	group = je_group_internal_affairs

	immediate = {
		set_variable = { name = je_anglois_integration_progress value = 0 }
		dua_set_dual_integration_variables = yes
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
		has_law = law_type:law_national_supremacy
	}

	on_complete = {
		trigger_event = { id = dvg_dua.2 }
	}

	scripted_button = dua_integration_anglois_button

	fail = {
		custom_tooltip = {
			text = dua_global_revolted_tooltip
			OR = {
				has_global_variable = dua_global_revolted
				AND = {
					is_diplomatic_play_committed_participant = no
					is_at_war = no
					has_revolution = no
					OR = {
						exists = c:ENG
						exists = c:FRA
					}
				}
			}
		}
		capital = {
			turmoil >= 0.5
		}
		NOT = {
			has_law = law_type:law_monarchy
		}
	}
	
	on_fail = {
		#trigger_event = { id = french_pretenders.6 popup = yes }
		if = {
			limit = {
				has_variable = dua_integration_freeze
			}
			remove_variable = dua_integration_freeze
		}
		dua_clear_dual_integration_variables = yes #It should not be possible for this JE to somehow be deleted without these variables being cleared.
	}

	on_timeout = {
		set_global_variable = dua_timeout
		if = {
			limit = {
				has_variable = dua_integration_freeze
			}
			remove_variable = dua_integration_freeze
		}
		dua_clear_dual_integration_variables = yes #It should not be possible for this JE to somehow be deleted without these variables being cleared.
	}

	modifiers_while_active = {
		dvg_fragile_country
	}

	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = {
						has_variable = dua_integration_freeze
					}
				}
				dua_weekly_pulse_anglois_progress = yes
			}
			set_variable = { name = je_anglois_integration_progress value = var:anglois_progress }
		}
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = {
						has_variable = dua_integration_freeze
					}
				}
				change_variable = { name = anglois_progress add = var:anglois_progress_next }
			}
		}
		random_events = {
			100 = 0
			25 = dvg_dua.110 # Patron
			25 = dvg_dua.111 # Publication of "Histoire de la France depuis ses origines"
			25 = dvg_dua.112 # Publication of "Saxon Poetry"
			25 = dvg_dua.113 # The Great Travel of the Dauphin
			25 = dvg_dua.114 # The 'Immortals'
			25 = dvg_dua.120 # Radical IG
			25 = dvg_dua.115 # Celebration of the German Revolution
			50 = dvg_dua.118 # Springtime 1848
			50 = dvg_dua.121 # Scottish subversion
			25 = dvg_dua.129
		}
	}
	
	current_value = {
		value = root.var:je_anglois_integration_progress
	}

	goal_add_value = {
		add = 1300
	}

	progressbar = yes

	timeout = 12775

	weight = 10000
	should_be_pinned_by_default = yes
}

je_french_integration = {
	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	group = je_group_internal_affairs

	immediate = {
		set_variable = { name = je_french_integration_progress value = 0 }
		dua_set_french_integration_variables = yes
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}

	on_complete = {
		trigger_event = { id = dvg_dua.4 }
	}

	scripted_button = dua_integration_french_button

	fail = {
		capital = {
			turmoil >= 0.5
		}
	}

	on_fail = {
		if = {
			limit = {
				has_variable = dua_integration_freeze
			}
			remove_variable = dua_integration_freeze
		}
		dua_clear_french_integration_variables = yes #It should not be possible for this JE to somehow be deleted without these variables being cleared.
	}

	modifiers_while_active = {
		dvg_fragile_country
	}

	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = {
						has_variable = dua_integration_freeze
					}
				}
				dua_weekly_pulse_french_progress = yes
			}
			set_variable = { name = je_french_integration_progress value = var:french_progress }
		}
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = {
						has_variable = dua_integration_freeze
					}
				}
				change_variable = { name = french_progress add = var:french_progress_next }
			}
		}
		random_events = {
			100 = 0
			25 = dvg_dua.110 # Patron
			25 = dvg_dua.211 #St Louis Speech
			25 = dvg_dua.212 #The great travel
			25 = dvg_dua.213 #Sons of Harold
			25 = dvg_dua.214 #Sorbonne
			25 = dvg_dua.129
		}
	}

	current_value = {
		value = root.var:je_french_integration_progress
	}

	goal_add_value = {
		add = 1000
	}

	progressbar = yes

	#timeout = 12775

	weight = 10000
	should_be_pinned_by_default = yes
}

je_english_integration = {
	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	group = je_group_internal_affairs

	immediate = {
		set_variable = { name = je_english_integration_progress value = 0 }
		dua_set_english_integration_variables = yes
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}

	on_complete = {
		trigger_event = { id = dvg_dua.6 }
	}

	scripted_button = dua_integration_english_button

	fail = {
		capital = {
			turmoil >= 0.5
		}
	}

	on_fail = {
		if = {
			limit = {
				has_variable = dua_integration_freeze
			}
			remove_variable = dua_integration_freeze
		}
		dua_clear_english_integration_variables = yes #It should not be possible for this JE to somehow be deleted without these variables being cleared.
	}

	modifiers_while_active = {
		dvg_fragile_country
	}

	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = {
						has_variable = dua_integration_freeze
					}
				}
				dua_weekly_pulse_english_progress = yes
			}
			set_variable = { name = je_english_integration_progress value = var:english_progress }
		}
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = {
						has_variable = dua_integration_freeze
					}
				}
				change_variable = { name = english_progress add = var:english_progress_next }
			}
		}
		random_events = {
			100 = 0
			25 = dvg_dua.110 # Patron
			25 = dvg_dua.311 #The great travel
			25 = dvg_dua.312 #Sons of St-Louis
			25 = dvg_dua.129
		}
	}

	current_value = {
		value = root.var:je_english_integration_progress
	}

	goal_add_value = {
		add = 1000
	}

	progressbar = yes

	#timeout = 12775

	weight = 10000
	should_be_pinned_by_default = yes
}

# Bureaucractic Reform
je_dua_bureaucracy = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	complete = {
		NOR = { 
			has_law = law_type:law_states_general
			has_law = law_type:law_land_based_taxation
			has_law = law_type:law_consumption_based_taxation
		}
		bureaucracy >= 0 
		approaching_bureaucracy_shortage = no
	}

	on_complete = {
		remove_modifier = dvg_outmoded_dua_bureaucracy
	}

	transferable = no

	weight = 5000
}

je_dua_army = {
	icon = "gfx/interface/icons/event_icons/event_skull.dds"
	should_be_pinned_by_default = yes

	group = je_group_internal_affairs

	complete = {
		NOR = { 
			has_law = law_type:law_states_general
			has_law = law_type:law_peasant_levies
		}
		bureaucracy >= 0 
	}

	on_complete = {
		remove_modifier = dvg_outmoded_dua_army
	}

	transferable = yes

	weight = 1000
}

je_total_revolution = {
	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	group = je_group_crises

	immediate = {
		dua_set_total_revolution_revolt_variables = yes
	}

	scripted_button = dua_total_revolution_button
	
	complete = {
		custom_tooltip = {
			text = anglois_accepted_tooltip
			has_global_variable = anglois_accepted
		}
	}

	on_complete = {
		#trigger_event = {
		#	id = dvg_dua.2
		#}
	}

	fail = {
		OR = {
			custom_tooltip = {
				text = dvg_dua_timeout
				has_variable = dua_timeout
			}
			custom_tooltip = {
				text = dvg_dua_control_lost
				AND = {
					NOT = { has_variable = occ_revolted }
					NOT = { has_variable = eng_revolted }
					OR = {
						exists = c:OCC
						exists = c:FRA
						exists = c:ENG
						exists = c:IRE
					}
					is_diplomatic_play_committed_participant = no
					is_at_war = no
					has_revolution = no
				}
			}
			scope:journal_entry = {
				is_goal_complete = yes
			}
			NOT = {
				has_law = law_type:law_monarchy
			}
		}
	}

	on_fail = {
		set_global_variable = dua_global_revolted
		trigger_event = {
			id = dvg_dua.500
		}
	}

	on_weekly_pulse = {
		effect = {
			dua_weekly_pulse_total_revolution_revolt = yes
		}
	}

	on_monthly_pulse = {
		effect = {
			change_variable = { name = dua_total_revolution_revolt add = var:dua_total_revolution_revolt_next }
		}
	}

	current_value = {
		value = root.var:dua_total_revolution_revolt
	}

	goal_add_value = {
		value = 100
	}

	progressbar = yes

	timeout = 8030

	weight = 10000
	should_be_pinned_by_default = yes
}
je_destroy_provence = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"

	group = je_group_foreign_affairs

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					exists = c:PRO
				}
				set_secret_goal = {
					country = c:PRO
					secret_goal = conquer
				}
			}
		}
	}

	possible = {
		NOT = {
			owns_entire_state_region = STATE_PROVENCE
		}
	}

	complete = {
		OR = {
			owns_entire_state_region = STATE_PROVENCE
		}
		any_neighbouring_state = {
			owner = c:AVN
		}	
	}

	on_complete = {
		trigger_event = { id = dvg_provence.11 }
	}
	
	invalid = {
		NOT = {exists = c:PRO}
	}
	should_be_pinned_by_default = yes
}

je_anglois_neo_absolutism = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_historical_content

	scripted_button = dua_neo_absolutism_papal_concordat_button
	scripted_button = dua_neo_absolutism_abolish_feudal_obligations_button

	scripted_progress_bar = dua_neo_absolutism_constitutional_pressure_progress_bar

	is_shown_in_lobby = {
		c:DUA ?= this
	}

	is_shown_when_inactive = {
		c:DUA ?= this
		has_law = law_type:law_monarchy
	}

	possible = {
		has_law_or_variant = law_type:law_autocracy
		has_law_or_variant = law_type:law_secret_police
		custom_tooltip = {
			text = je_anglois_neo_absolutism_possible_tt
			NOT = {
				any_subject_or_below = {
					OR = {
						is_subject_type = subject_type_vassal
						is_subject_type = subject_type_puppet
					}
				}
			}
		}
		OR = {
			any_interest_group_in_government = {
				is_interest_group_type = ig_petty_bourgeoisie
				is_powerful = yes
			}
			custom_tooltip = {
				text = pb_ruler_tt
				ruler.interest_group ?= ig:ig_petty_bourgeoisie
			}
		}
	}

	immediate = {
		set_variable = {
			name = dua_gdp_var
			value = root.gdp
		}
	}

	modifiers_while_active = {
		modifier_anglois_state_police
	}

	complete = {
		calc_true_if = {
			amount >= 4
			trigger_if = {
				limit = {
					has_variable = dua_gdp_var
				}
				gdp > {
					value = var:dua_gdp_var
					multiply = 1.5
				}
			}
			AND = {
				custom_tooltip = {
					text = dua_rank_three_or_above_tt
					global_country_ranking <= 3
				}
				OR = {
					NAND = {
						exists = c:BRG
						c:GER ?= {
							NOT = {
								was_formed_from = AUS
							}
						}
					}
					trigger_if = {
						limit = {
							exists = c:BRG
						}
						custom_tooltip = {
							text = dua_gdp_higher_than_BRG
							root.gdp > c:BRG.gdp
						}
					}
				}
			}
			custom_tooltip = {
				text = je_dua_neo_absolutism_completion_papal_concordat_tt
				has_variable = je_austrian_neo_absolutism_marginalized_papal_concordat_var
			}
			custom_tooltip = {
				text = je_dua_neo_absolutism_completion_feudal_obligations_tt
				has_variable = je_austrian_neo_absolutism_marginalized_feudal_obligations_var
			}
		}
	}

	on_complete = {
		show_as_tooltip = {
			activate_law = law_type:law_neo_absolutism
		}

		set_variable = je_dua_neo_absolutism_complete_var
		
		trigger_event = { id = dua_absolutism.1 popup = yes }
	}

	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_dua_events.1_tt
			}
		}
	}

	fail = {
		OR = {
			custom_tooltip = {
				text = je_dua_neo_absolutism_fail_tt
				je:je_dua_neo_absolutism ?= {
					"scripted_bar_progress(dua_neo_absolutism_constitutional_pressure_progress_bar)" >= 100
				}
			}
			NOT = {
				has_law_or_variant = law_type:law_autocracy
			}
			NOT = {
				has_law_or_variant = law_type:law_secret_police
			}
		}
	}

	event_outcome_failed_desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					je:je_dua_neo_absolutism ?= {
						"scripted_bar_progress(dua_neo_absolutism_constitutional_pressure_progress_bar)" >= 100
					}
				}
				desc = event_effects_dua_events.2_tt
			}
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = event_effects_dua_events.5_tt
			}
		}
	}

	status_desc = {
		first_valid = {
			triggered_desc = {
				desc = je_dua_neo_absolutism_status
				trigger = {
					NOT = {
						has_journal_entry = je_dua_neo_absolutism
					}
				}
			}
			triggered_desc = {
				desc = je_dua_neo_absolutism_status_1
				trigger = {
					scope:journal_entry ?= {
						"scripted_bar_progress(dua_neo_absolutism_constitutional_pressure_progress_bar)" <= 25
					}
				}
			}
			triggered_desc = {
				desc = je_dua_neo_absolutism_status_2
				trigger = {
					scope:journal_entry ?= {
						"scripted_bar_progress(dua_neo_absolutism_constitutional_pressure_progress_bar)" > 25
					}
					scope:journal_entry ?= {
						"scripted_bar_progress(dua_neo_absolutism_constitutional_pressure_progress_bar)" <= 50
					}
				}
			}
			triggered_desc = {
				desc = je_dua_neo_absolutism_status_3
				trigger = {
					scope:journal_entry ?= {
						"scripted_bar_progress(dua_neo_absolutism_constitutional_pressure_progress_bar)" > 50
					}
					scope:journal_entry ?= {
						"scripted_bar_progress(dua_neo_absolutism_constitutional_pressure_progress_bar)" <= 75
					}
				}
			}
			triggered_desc = {
				desc = je_dua_neo_absolutism_status_4
				trigger = {
					scope:journal_entry ?= {
						"scripted_bar_progress(dua_neo_absolutism_constitutional_pressure_progress_bar)" > 75
					}
					scope:journal_entry ?= {
						"scripted_bar_progress(dua_neo_absolutism_constitutional_pressure_progress_bar)" <= 100
					}
				}
			}
		}
	}

	on_fail = {
		if = {
			limit = {
				je:je_dua_neo_absolutism ?= {
					"scripted_bar_progress(austrian_neo_absolutism_constitutional_pressure_progress_bar)" >= 100
				}
			}
			trigger_event = { id = dua_absolutism.2 popup = yes }
		}
		else = {
			trigger_event = { id = dua_absolutism.5 popup = yes }
		}
		set_variable = je_dua_neo_absolutism_failed_var
	}

	invalid = {
		OR = {
			NOT = {
				has_law_or_variant = law_type:law_autocracy
			}
			NOT = {
				has_law_or_variant = law_type:law_secret_police
			}
		}
	}

	on_invalid = {
		set_variable = je_dua_neo_absolutism_failed_var
	}

	weight = 100
	should_be_pinned_by_default = yes
}

#Dual Monarquie Fascism - Nota mental, Imperador Tiago "meu deus"

je_action_anglo_francaise = {
	group = je_group_historical_content
	icon = "gfx/interface/icons/law_icons/corporate_state.dds"

	scripted_button = je_aaf_eliminate_parliament

	should_be_pinned_by_default = yes
	weight = 10000

	is_shown_when_inactive = {
		c:DUA ?= this
		has_technology_researched = corporatism
	}

	possible = {
		OR = {
			has_law_or_variant = law_type:law_census_voting
			has_law_or_variant = law_type:law_universal_suffrage
		}
		NOR = {
			has_law_or_variant = law_type:law_neo_absolutism
		}
		has_technology_researched = political_agitation
		any_political_movement = {
			is_political_movement_type = movement_corporatist
		}
		OR = {
			has_law_or_variant = law_type:law_corporate_state
			is_enacting_law = law_type:law_corporate_state
			any_political_movement = {
				is_political_movement_type = movement_corporatist
				political_movement_support >= 0.05
				political_movement_radicalism >= define:NPolitics|RADICALISM_AGITATING_THRESHOLD
			}
		}
	}

	immediate = {
		random_political_movement = {
			limit = {
				is_political_movement_type = movement_corporatist
			}
			save_scope_as = corporatist_movement_scope
		}
		ordered_interest_group = {
			limit = {
				OR = {
					is_interest_group_type = ig_petty_bourgeoisie
					is_interest_group_type = ig_devout
					is_interest_group_type = ig_landowners
					is_interest_group_type = ig_rural_folk
				}
			}
			order_by = ig_clout
			position = 0
			check_range_bounds = no
			if = {
				limit = {
					ROOT = {
						NOT = {
							any_scope_character = {
								AND = {
									OR = {
										has_role = politician
										has_role = agitator
									}
									has_ideology = ideology:ideology_corporatist_leader
								}
							}
						}
					}
				}
				ROOT = {
					custom_tooltip = {
						text = corporatist_agitator_appears_tt
						create_character = {
							culture = primary_culture
							is_agitator = yes
							interest_group = prev
							ideology = ideology_corporatist_leader
							traits = {
								demagogue
								basic_political_operator
							}
						}
					}
				}
			}
		}
		set_variable = { name = corporatists_suppression_var value = 0 }
		trigger_event = { id = dua_fascism.1 popup = yes }
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					any_political_movement = {
						is_political_movement_type = movement_corporatist
						political_movement_support < 0.05
					}
				}
				change_variable = { name = corporatists_suppression_var add = 1 }
			}
			else = {
				set_variable = { name = corporatists_suppression_var value = 0 }
			}
		}
	}

	complete = {
		has_law_or_variant = law_type:law_single_party_state
		has_law_or_variant = law_type:law_corporate_state
		has_law_or_variant = law_type:law_corporatized_unions
		has_law_or_variant = law_type:law_state_religion
		has_law_or_variant = law_type:law_interventionism
		custom_tooltip = {
			text = fascism_2_tt
			trigger_if = {
				limit = {
					any_interest_group = {
						leader = {
							OR = {
								has_socialist_ideology = yes
								has_ideology = ideology:ideology_radical
							}
						}
					}
				}
				any_interest_group = {
					filter = {
						leader = {
							OR = {
								has_socialist_ideology = yes
								has_ideology = ideology:ideology_radical
							}
						}
					}
					ig_counts_as_marginal = yes
					count = all
				}
			}
		}
		custom_tooltip = {
			text = fascism_3_tt
			trigger_if = {
				limit = {
					any_political_movement = {
						OR = {
							is_political_movement_type = movement_radical
							movement_is_socialist = yes
						}
					}
				}
				any_political_movement = {
					filter = {
						OR = {
							is_political_movement_type = movement_radical
							movement_is_socialist = yes
						}
					}
					OR = {
						is_being_suppressed = yes
						political_movement_support <= 0.05
					}
					count = all
				}
			}
		}
		has_revolution = no
		has_any_secessionists_broken_out = no
	}

	on_complete = {
		trigger_event = { id = dua_fascism.2 popup = yes }
	}

	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_dua_austrian_fascism.2_tt
			}
		}
	}

	fail = {
		OR = {
			trigger_if = {
				limit = {
					exists = scope:corporatist_movement_scope
				}
				custom_tooltip = {
					text = corporatist_movement_disbanded_tt
					NOT = {
						exists = scope:corporatist_movement_scope
					}
				}
			}
			trigger_else = {
				custom_tooltip = {
					text = corporatist_movement_disbanded_dummy_tt
					NOT = {
						exists = scope:corporatist_movement_scope
					}
				}
			}
			AND = {
				custom_tooltip = {
					text = no_interest_group_in_government_is_corporatist_tt
					NOT = {
						any_interest_group = {
							is_in_government = yes
							OR = {
								has_ideology = ideology:ideology_corporatist
								any_scope_character = {
									OR = {
										has_role = politician
										has_role = agitator
									}
									OR = {
										has_ideology = ideology:ideology_corporatist_leader
										has_ideology = ideology:ideology_fascist
										has_ideology = ideology:ideology_integralist
									}
								}
							}
						}
					}
				}
				OR = {
					trigger_if = {
						limit = {
							has_variable = corporatists_suppression_var
							exists = scope:corporatist_movement_scope
						}
						custom_tooltip = {
							text = has_repressed_corporatists_for_some_years_tt
							var:corporatists_suppression_var >= 24
							any_political_movement = {
								is_political_movement_type = movement_corporatist
								political_movement_support < 0.05
							}
						}
					}
				}
			}
		}
	}

	on_fail = {
		trigger_event = { id = dua_fascism.3 popup = yes }
	}

	event_outcome_failed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_dua_fascism.3_tt
			}
		}
	}
}

#Dual Monarquie new national organization

je_dua_federal_pact = {
	icon = "gfx/interface/icons/event_icons/event_map.dds"

	group = je_group_historical_content

	is_shown_when_inactive = {
		has_law_or_variant = law_provincial_councils
		has_technology_researched = nationalism
		c:DUA ?= this
	}

	possible = {
		OR = {
			has_government_type = gov_dual_monarquie
		}
		has_technology_researched = pan-nationalism
		NOR = {
			has_law_or_variant = law_type:law_ethnostate
			has_law_or_variant = law_type:law_national_supremacy
		}
	}

	immediate = {
		ig:ig_armed_forces ?= {
			save_scope_as = armed_forces_ig
		}
		set_variable = { name = count_integrated_cultures value = 0 }
		set_variable = { name = count_disqualified_cultures value = 0 }
		if = {
			limit = {
				NOT = {
					has_variable = received_federation_proposal
				}
			}
			trigger_event = { id = dua_federation.1 popup = yes }
		}
		dua_federation_calculate_path_to_victory = yes
	}

	scripted_button = je_dua_federation_english_button
	scripted_button = je_dua_federation_french_button
	scripted_button = je_dua_federation_occitanian_button
	scripted_button = je_dua_federation_irish_button
	scripted_button = je_dua_federation_welsh_button
	scripted_button = je_dua_federation_enact_the_federation

	on_weekly_pulse = {

	}

	on_monthly_pulse = {
		effect = {
			dua_federation_calculate_path_to_victory = yes
		}
	}

	complete = {
		trigger_if = {
			limit = {
				has_variable = count_integrated_cultures
			}
			custom_tooltip = {
				text = has_integrated_2_dua_cultures_tt
				var:count_integrated_cultures >= 2
			}
		}
		custom_tooltip = {
			text = dua_federation_final_act_tt
			has_variable = dua_federation_final_act
		}
		trigger_if = {
			limit = {
				any_subject_or_below = {
					OR = {
						is_subject_type = subject_type_personal_union
						is_subject_type = subject_type_puppet
					}
					capital = {
						OR = {
							region = sr:region_france
							region = sr:region_occitania
							region = sr:region_italy
							region = sr:region_england
						}
					}
				}
			}
			any_subject_or_below = {
				filter = {
					OR = {
						is_subject_type = subject_type_personal_union
						is_subject_type = subject_type_puppet
					}
					capital = {
						OR = {
							region = sr:region_france
							region = sr:region_occitania
							region = sr:region_italy
							region = sr:region_england
						}
					}
				}
				custom_tooltip = capital_is_in_dua_states_tt
				OR = {
					custom_tooltip = {
						text = all_primary_cultures_integrated_tt
						any_primary_culture = {
							save_temporary_scope_as = subject_primary_culture
							ROOT = {
								any_in_list = {
									variable = dua_integrated_cultures
									scope:subject_primary_culture ?= this
								}
							}
							percent = 1
						}
					}
					AND = {
						relations:root >= relations_threshold:amicable
						liberty_desire < define:NDiplomacy|WAR_GOAL_INFAMY_LOW_LIBERTY_DESIRE_THRESHOLD
					}
				}
				count = all
			}
		}
		is_diplomatic_play_committed_participant = no
		is_at_war = no
	}

	on_complete = {
		every_subject_or_below = {
			limit = {
				OR = {
					is_subject_type = subject_type_personal_union
					is_subject_type = subject_type_puppet
				}
				capital = {
					OR = {
						region = sr:region_france
						region = sr:region_occitania
						region = sr:region_italy
						region = sr:region_england
					}
				}
			}
			c:AUS ?= {
				annex_with_incorporation = prev
			}
		}
		custom_tooltip = {
			text = dua_tradition_traits_tt
			every_scope_culture = {
				limit = {
					has_discrimination_trait_group = heritage_group_european
					save_temporary_scope_as = temp_culture_scope
					ROOT = {
						any_scope_state = {
							OR = {
								region = sr:region_france
								region = sr:region_occitania
								region = sr:region_italy
								region = sr:region_england
							}
							state_region = {
								is_homeland = scope:temp_culture_scope
							}
						}
					}
				}
				add_tradition_trait = tradition_danubian
			}
		}
		if = {
			limit = {
				has_law = law_type:law_monarchy
			}
			custom_tooltip = {
				text = change_tag_to_DUA_monarchy_tt
				change_tag = DUA
			}
		}
		else = {
			limit = {
				OR = {
					has_law_or_variant = law_type:law_parliamentary_republic
					has_law_or_variant = law_type:law_presidential_republic
				}
			}
			custom_tooltip = {
				text = change_tag_to_DUA_republic_tt
				change_tag = DUA
			}
		}
		trigger_event = { id = dua_federation.2 }
		set_variable = dua_federation_done_with
		set_variable = achievement_dua_federation
	}

	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_dua_federation.2_tt
			}
		}
	}

	fail = {
		OR = {
			trigger_if = {
				limit = {
					has_variable = dua_federation_potential_points
					dua_federation_remaining_cultures_to_integrate > 0
				}
				custom_tooltip = { # failsafe
					text = has_no_way_to_integrate_2_dua_cultures_tt
					AND = {
						var:count_integrated_cultures < 2
						var:dua_federation_potential_points <= {
							value = 2 # The minimum number of cultures needed to get over the hill
							subtract = var:count_integrated_cultures
						}
					}
				}
			}
			any_civil_war = {
				civil_war_progress >= 0.75
				OR = {
					is_civil_war_type = revolution
					AND = {
						is_civil_war_type = secession
						political_movement.culture ?= {
							OR = {
								has_discrimination_trait_group = language_group_germanic
								has_discrimination_trait = heritage_gallic
								has_discrimination_trait = heritage_british
							}
						}
					}
				}
			}
			has_law_or_variant = law_type:law_ethnostate
			has_law_or_variant = law_type:law_national_supremacy
		}
	}

	on_fail = {
		custom_tooltip = lose_integrated_cultures_tt
		if = {
			limit = {
				has_variable_list = dua_integrated_cultures
			}
			every_in_list = {
				variable = dua_integrated_cultures
				if = {
					limit = {
						is_primary_culture_of = ROOT
					}
					ROOT = {
						remove_primary_culture = prev
					}
				}
			}
		}
		set_variable = dua_federation_done_with
	}

	invalid = {
		has_variable = shelved_federation_proposal
	}

	weight = 100

	should_be_pinned_by_default = yes
}

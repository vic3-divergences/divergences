### ATTENTION: Overwrite vanilla interactions in here and nowhere else

exile_character = {
	clicksound = "event:/SFX/DLC/1.3_ip1/UI/exile_character"

	potential = {
		is_in_exile_pool = no
		is_in_void = no
		is_ruler = no
		is_heir = no
		# Cannot exile pure commanders, we have the retire interaction for that
		OR = {
			has_role = politician
			has_role = agitator
		}
	}

	show_requirements = yes

	possible = {
		owner = {
			NOT = {
				has_law = law_type:law_protected_speech
			}
		}
		AND = {
			OR = {
				interest_group = {
					is_in_government = no
					is_insurrectionary = no
					is_marginal = no
				}
				has_role = agitator
		
			}
			NOT = {
				has_variable = is_nasir
			}
			NOT = {
				has_variable = is_qutb
			}
			NOT = {
				has_trait = immortal
			}
		}
	}

	effect = {
		this.interest_group = {
			save_scope_as = relevant_ig
		}
		this = {
			save_scope_as = exile_scope
		}
		owner = {
			save_scope_as = exiling_country_scope
		}
		if = {
			limit = {
				owner = {
					is_player = yes
					NOT = { has_variable = achievement_agitate_elsewhere_var }
				}
				popularity >= 100
			}
			owner = { set_variable = achievement_agitate_elsewhere_var }
		}
		hidden_effect = {
			if = {
				limit = {
					NOT = { has_role = agitator }
				}
				add_character_role = agitator
			}
			if = {
				limit = {
					has_role = general
				}
				remove_character_role = general
			}
			if = {
				limit = {
					has_role = admiral
				}
				remove_character_role = admiral
			}
			if = {
				limit = {
					has_role = politician
				}
				set_as_interest_group_leader = no
				remove_character_role = politician
			}
		}
		owner = {
			custom_tooltip = exiling_dissident_radicals_factors
		}
		# Extra radical from exiling a popular character
		if = {
			limit = {
				popularity >= 50
			}
			owner = {
				add_radicals = {
					value = small_radicals
					interest_group = scope:relevant_ig
				}
			}
		}
		# Standard radicals from having Right of Assembly
		if = {
			limit = {
				owner = { has_law = law_type:law_right_of_assembly }
			}
			owner = {
				add_radicals = {
					value = medium_radicals
					interest_group = scope:relevant_ig
				}
			}
		}
		# Fewer radicals from Censorship
		else_if = {
			limit = {
				owner = { has_law = law_type:law_censorship }
			}
			owner = {
				add_radicals = {
					value = small_radicals
					interest_group = scope:relevant_ig
				}
			}
		}
		# Boring characters should be made interesting when being exiled
		if = {
			limit = {
				has_ideology = ideology:ideology_moderate
			}
			adopt_random_antigovernment_ideology = yes
		}
		hidden_effect = {
			if = {
				limit = {
					popularity > 15
				}
				add_modifier = {
					name = in_exile_modifier
				}
				every_country = {
					limit = {
						has_diplomatic_relevance = scope:exiling_country_scope
					}
					post_notification = exile_notification
				}
			}
			else = {
				add_modifier = {
					name = in_exile_modifier
					multiplier = 3
				}
			}
		}
		custom_tooltip = {
			text = exile_dissident_tt
			exile_character_with_martyrdom = yes
		}
	}

	cooldown = { days = 1825 }
	show_confirmation_box = yes

	ai_chance = {
		value = -50
		if = {
			limit = {
				interest_group = {
					ig_approval <= -5
				}		
			}
			add = 25
		}
		if = {
			limit = {
				interest_group = {
					ig_approval <= -10
				}		
			}
			add = 30
		}
		if = {
			limit = {
				scope:actor ?= {
					NOR = {
						has_law = law_type:law_autocracy
						has_law = law_type:law_oligarchy
						has_law = law_type:law_single_party_state
					}
				}			
			}
			add = -25
		}
		if = {
			limit = {
				scope:actor ?= {
					has_law = law_type:law_secret_police
				}			
			}
			add = 30
		}
		if = {
			limit = {
				scope:actor ?= {
					has_law = law_type:law_national_guard
				}			
			}
			add = 15
		}
		if = {
			limit = {
				scope:actor ?= {
					has_law = law_type:law_guaranteed_liberties
				}			
			}
			add = -100
		}
		if = {
			limit = {
				scope:actor ?= {
					has_law = law_type:law_outlawed_dissent
				}			
			}
			add = 30
		}
		if = {
			limit = {
				scope:actor ?= {
					has_law = law_type:law_censorship
				}			
			}
			add = 10
		}
		if = {
			limit = {
				scope:actor ?= {
					has_law = law_type:law_right_of_assembly
				}			
			}
			add = -10
		}
		if = {
			limit = {
				scope:actor ?= {
					has_law = law_type:law_protected_speech
				}			
			}
			add = -20
		}
	}
}

abdicate_monarch = {
	icon = "gfx/interface/icons/ideology_icons/ideology_leader/ideology_leader_republican.dds"
	clicksound = "event:/SFX/UI/Military/command_grant"

	potential = {
		has_dlc_feature = voice_of_the_people_content
		owner ?= scope:actor
		is_ruler = yes
		owner ?= {
			has_law = law_type:law_monarchy
		}
		exists = owner.heir
		is_immortal = no
	}

	possible = {
		OR = {
			interest_group = {
				is_marginal = yes
			}
			popularity <= -50
			NOT = {
				has_trait = immortal
			}
			has_trait = psychological_affliction
			age >= 60
			owner ?= { # Our thanks to UHM for reporting this
				trigger_if = {
					limit = {
						any_political_movement = {
							is_insurrectionary = yes
							exists = most_desired_law
						}
					}
					any_political_movement = {
						is_insurrectionary = yes
						exists = most_desired_law
						most_desired_law ?= { save_temporary_scope_as = revolutionary_law }
						custom_tooltip = {
							text = ruler_disapproves_of_revolutionary_law
							root = {
								OR = {
									law_enactment_stance = {
										law = scope:revolutionary_law
										value < neutral
									}
									interest_group ?= {
										law_enactment_stance = {
											law = scope:revolutionary_law
											value < neutral
										}
									}
								}
							}
						}
					}
				}
				trigger_else = {
					AND = {
						any_political_movement = {
							is_insurrectionary = yes
						}
						custom_tooltip = {
							text = ruler_disapproves_of_revolutionary_law_contextless
							always = no
						}
					}
				}
			}
		}
		trigger_if = {
			limit = {
				NOT = {
					owner ?= {
						any_interest_group = {
							is_insurrectionary = yes
						}
					}
				}
			}
			owner.heir = {
				age >= 18
			}
		}
	}

	effect = {
		custom_tooltip = leader_abdicates_the_throne_display_tt
		if = {
			limit = {
				owner ?= {
					any_political_movement = {
						exists = most_desired_law
						is_insurrectionary = yes
					}
				}
			}
			owner ?= {
				trigger_event = { id = resignation.3 popup = yes }
			}
		}
		else = {
			owner ?= {
				trigger_event = { id = wedding.3 popup = yes}
			}
		}
	}

	cooldown = { months = 360 }
	show_confirmation_box = yes

	ai_chance = {
		value = -50
		if = {
			limit = {
				interest_group = {
					ig_approval <= angry
				}
			}
			add = 25
		}
		if = {
			limit = {
				interest_group = {
					is_marginal = yes
				}
			}
			add = 25
		}
		if = {
			limit = {
				popularity <= -50
			}
			add = 25
		}
		if = {
			limit = {
				popularity <= -75
			}
			add = 25
		}
		if = {
			limit = {
				age >= 75
			}
			add = 50
		}
		if = {
			limit = {
				has_trait = psychological_affliction
			}
			add = 25
		}
	}
}